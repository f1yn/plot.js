"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),plot=function(){function e(t,i){_classCallCheck(this,e);var n=document.createElement("canvas");i="object"===(void 0===i?"undefined":_typeof(i))?i:{},this.functions=[],this.color={grid:"string"==typeof i.gridColor?i.gridColor:"#ddd",axis:"string"==typeof i.axisColor?i.axisColor:"#888"},this.redrawRate="number"==typeof i.redrawRate?i.redrawRate:33,this.labels="boolean"!=typeof i.labels||i.labels,this.renderFunctions="boolean"!=typeof i.renderFunctions||i.renderFunctions,this.scaleX="number"==typeof i.scaleX?i.scaleX:1,this.scaleY="number"==typeof i.scaleY?i.scaleY:1,this.offsetX="number"==typeof i.offsetX?i.offsetX:0,this.offsetY="number"==typeof i.offsetY?i.offsetY:0,this.panX="number"==typeof i.panX?i.panX:0,this.panY="number"==typeof i.panY?i.panY:0,i.initRender="boolean"!=typeof i.initRender||i.initRender;var o=this._UID();switch(this.resizeTimeoutID="_plot-resize-"+o,n.style.cursor="inherit",t.innerHTML="",t.style.overflow="hidden",t.appendChild(this.canvas=n),console.log(_typeof(i.hammerize),i.hammerize),_typeof(i.hammerize)){case"function":console.log("whoah"),this.hammerize(i.hammerize);break;case"boolean":i.hammerize&&("function"==typeof window.Hammer?this.hammerize(window.Hammer):console.warn("no global Hammer constructor is preset, ignoring"));break;case"undefined":break;default:console.warn("unrecognized Hammer constructor is preset, ignoring")}i.initRender&&this.adjustSize().goToOrigin().redraw()}return _createClass(e,[{key:"_UID",value:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()}},{key:"_roundBaseX",value:function(e,t){return Math.pow(t,Math.floor(this._getBaseLog(t,e)))}},{key:"_getBaseLog",value:function(e,t){return Math.log(t)/Math.log(e)}},{key:"_strip",value:function(e){return parseFloat(e.toPrecision(4))}},{key:"_stripFixed",value:function(e){return parseFloat(e.toFixed(6))}},{key:"_isArray",value:function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"number"==typeof e.length}},{key:"_clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"_drawIntercepts",value:function(){var e=this.canvas,t=e.width,i=e.height,n=-this.offsetX,o=-this.offsetY,s=e.getContext("2d");s.strokeStyle=this.color.axis,s.lineWidth=1,s.font="bold 18px Arial",n>=0&&n<=t&&(s.beginPath(),s.moveTo(n,0),s.lineTo(n,i),s.closePath(),o>10&&s.fillText("y",n+9,20),o<i&&s.fillText("-y",n+9,i-10),s.stroke()),o>=0&&o<=i&&(s.beginPath(),s.moveTo(0,o),s.lineTo(t,o),s.closePath(),n>10&&s.fillText("-x",10,o+16),n<t&&s.fillText("x",t-20,o+16),s.stroke())}},{key:"_drawGrid",value:function(){var e=this.canvas,t=this.scaleX,i=this.scaleY,n=this.offsetX,o=this.offsetY,s=e.width,r=e.height,a=(64/this._roundBaseX(t,2)).toPrecision(8),f=(64/this._roundBaseX(i,2)).toPrecision(8),h=e.getContext("2d"),l=this._stripFixed,c=[],u=[],d=0,p=void 0,v=void 0,y=void 0,m=void 0;for(h.strokeStyle=this.color.grid,h.lineWidth=1,h.font="bold 10px Arial",h.textBaseline="middle",h.fontcolor="#333",h.beginPath(),n>0?d=Math.ceil(n/t/a)*a:n<0&&(d=Math.floor(n/t/a)*a),p=2+~~(s/t/a);p--;)v=(m=d+a*p)*t-n,h.moveTo(v,0),h.lineTo(v,r),c[p]=[l(m),v];for(d=o<0?Math.floor(o/i/f)*f:o>0?Math.ceil(o/i/f)*f:0,p=2+~~(r/i/f);p--;)y=(m=d+f*p)*i-o,h.moveTo(0,y),h.lineTo(s,y),u[p]=[l(-m),y];if(h.closePath(),h.stroke(),h.fillStyle="#444",p=c.length,this.labels){for(;p--;)m=c[p][0],h.fillText(m,c[p][1]-h.measureText(m).width/2,10);for(p=u.length;p--;)h.fillText(u[p][0]+"",4,u[p][1])}}},{key:"_drawFunction",value:function(e,t){if("function"==typeof e){t="object"===(void 0===t?"undefined":_typeof(t))?t:{};var i=this.canvas,n=this.offsetX,o=this.offsetY,s=this.scaleX,r=this.scaleY,a="number"==typeof t.width?t.width:i.width,f="number"==typeof t.min?t.min:n/s,h="number"==typeof t.max?t.max:(a+n)/s,l=f*s-n;if(!(l>a||f>=h)){var c=i.getContext("2d"),u=-e(f)*r-o,d=void 0;for(c.strokeStyle="string"==typeof t.color?t.color:"#000000",c.lineWidth=1,c.beginPath();l<a&&!((d=(l+n)/s)>h);)c.moveTo(l++,u),c.lineTo(l,u=-e(d)*r-o);c.closePath(),c.stroke()}}}},{key:"_resizeWindowEvent",value:function(e){var t=this;clearTimeout(window[t.resizeTimeoutID]),window[t.resizeTimeoutID]=setTimeout(function(){t.adjustSize().redraw()},t.redrawRate)}},{key:"_panStartEvent",value:function(e){this.panX=this.offsetX,this.panY=this.offsetY,this.canvas.parentNode.style.cursor="grabbing"}},{key:"_panMoveEvent",value:function(e){this.offsetX=this.panX-e.deltaX,this.offsetY=this.panY-e.deltaY,this.redraw(!0)}},{key:"_panEndEvent",value:function(e){this.panX=this.panY=0,this.canvas.parentNode.style.cursor=""}},{key:"drawFunctions",value:function(e){var t=this._isArray(e)&&e.length>0?e:this.functions;if(!this._isArray(t))return console.warning("invalid input object, skipping rendering phase"),this;for(var i=t.length,n=void 0,o=void 0;i--;)switch(n=t[i],o={width:this.canvas.width},void 0===n?"undefined":_typeof(n)){case"function":this._drawFunction(n,o);break;case"object":"function"==typeof n.fcn&&this._drawFunction(n.fcn,o)}return this}},{key:"setPosition",value:function(e,t){return this.offsetX="number"==typeof e?e:this.offsetX,this.offsetY="number"==typeof t?t:this.offsetY,this}},{key:"setPositionX",value:function(e){return this.offsetX="number"==typeof e?e:this.offsetX,this}},{key:"setPositionY",value:function(e){return this.offsetY="number"==typeof e?e:this.offsetY,this}},{key:"goToOrigin",value:function(){return this.offsetX=~~(-this.canvas.width/2),this.offsetY=~~(-this.canvas.height/2),this}},{key:"adjustSize",value:function(){var e=this.canvas.parentNode;return this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this}},{key:"hammerize",value:function(e){if(console.log(e),"function"==typeof e){window.addEventListener("resize",this._resizeWindowEvent.bind(this));var t=new e(this.canvas);t.on("panstart",this._panStartEvent.bind(this)),t.on("panmove",this._panMoveEvent.bind(this)),t.on("panend",this._panEndEvent.bind(this))}else console.warn("invalid Hammer constructor passed as arg");return this}},{key:"redraw",value:function(e){return e&&this._clearCanvas(this.canvas),this.renderFunctions&&this.drawFunctions(),this._drawGrid(),this._drawIntercepts(),this}}]),e}();"undefined"!=typeof module&&(module.exports=plot);