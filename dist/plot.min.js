"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),plot=function(){function e(t,i){_classCallCheck(this,e);var n=document.createElement("canvas");i="object"===(void 0===i?"undefined":_typeof(i))?i:{},this.functions=[],i.color="object"===_typeof(i.color)?i.color:{};var o="string"==typeof i.color.axisLabel?i.color.axisLabel:"";this.color={grid:"string"==typeof i.color.grid?i.color.grid:"#ddd",axis:"string"==typeof i.color.axis?i.color.axis:"#888",axisLabelX:"string"==typeof i.color.axisLabelX?i.color.axisLabelX:o||"#444",axisLabelY:"string"==typeof i.color.axisLabelY?i.color.axisLabelY:o||"#444",labelX:"string"==typeof i.color.labelX?i.color.labelX:"#444",labelY:"string"==typeof i.color.labelY?i.color.labelY:"#444"},this.redrawRate="number"==typeof i.redrawRate?i.redrawRate:33,this.labels="boolean"!=typeof i.labels||i.labels,this.renderFunctions="boolean"!=typeof i.renderFunctions||i.renderFunctions,this.scaleX="number"==typeof i.scaleX?i.scaleX:1,this.scaleY="number"==typeof i.scaleY?i.scaleY:1,this.offsetX="number"==typeof i.offsetX?i.offsetX:0,this.offsetY="number"==typeof i.offsetY?i.offsetY:0,this.panX="number"==typeof i.panX?i.panX:0,this.panY="number"==typeof i.panY?i.panY:0,this.labelSize="number"==typeof i.labelSize?i.labelSize:10,this.axisLabelSize="number"==typeof i.axisLabelSize?i.axisLabelSize:18,i.initRender="boolean"!=typeof i.initRender||i.initRender;var s=this._UID();switch(this.resizeTimeoutID="_plot-resize-"+s,n.style.cursor="inherit",t.innerHTML="",t.style.overflow="hidden",t.appendChild(this.canvas=n),console.log(_typeof(i.hammerize),i.hammerize),_typeof(i.hammerize)){case"function":this.hammerize(i.hammerize);break;case"boolean":i.hammerize&&("function"==typeof window.Hammer?this.hammerize(window.Hammer):console.warn("no global Hammer constructor is preset, ignoring"));break;case"undefined":break;default:console.warn("unrecognized Hammer constructor is preset, ignoring")}i.initRender&&this.adjustSize().goToOrigin().redraw()}return _createClass(e,[{key:"_UID",value:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()}},{key:"_roundBaseX",value:function(e,t){return Math.pow(t,Math.floor(this._getBaseLog(t,e)))}},{key:"_getBaseLog",value:function(e,t){return Math.log(t)/Math.log(e)}},{key:"_strip",value:function(e){return parseFloat(e.toPrecision(4))}},{key:"_stripFixed",value:function(e){return parseFloat(e.toFixed(6))}},{key:"_isArray",value:function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"number"==typeof e.length}},{key:"_clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"_drawIntercepts",value:function(){var e=this.canvas,t=e.width,i=e.height,n=-this.offsetX,o=-this.offsetY,s=e.getContext("2d");s.strokeStyle=this.color.axis,s.lineWidth=1,s.font="bold "+this.axisLabelSize+"px Arial",s.fillStyle=this.color.axisLabelY,n>=0&&n<=t&&(s.beginPath(),s.moveTo(n,0),s.lineTo(n,i),s.closePath(),o>10&&s.fillText("y",n+9,20),o<i&&s.fillText("-y",n+9,i-10),s.stroke()),s.fillStyle=this.color.axisLabelX,o>=0&&o<=i&&(s.beginPath(),s.moveTo(0,o),s.lineTo(t,o),s.closePath(),n>10&&s.fillText("-x",10,o+16),n<t&&s.fillText("x",t-20,o+16),s.stroke())}},{key:"_drawGrid",value:function(){var e=this.canvas,t=this.scaleX,i=this.scaleY,n=this.offsetX,o=this.offsetY,s=e.width,a=e.height,r=(64/this._roundBaseX(t,2)).toPrecision(8),l=(64/this._roundBaseX(i,2)).toPrecision(8),f=e.getContext("2d"),c=this._stripFixed,h=[],u=[],d=0,y=void 0,v=void 0,p=void 0,b=void 0,m=void 0;for(f.strokeStyle=this.color.grid,f.lineWidth=1,f.font="bold "+this.labelSize+"px Arial",f.textBaseline="middle",f.beginPath(),n>0?d=Math.ceil(n/t/r)*r:n<0&&(d=Math.floor(n/t/r)*r),y=2+~~(s/t/r);y--;)v=(b=d+r*y)*t-n,f.moveTo(v,0),f.lineTo(v,a),h[y]=[c(b),v];for(d=o<0?Math.floor(o/i/l)*l:o>0?Math.ceil(o/i/l)*l:0,y=2+~~(a/i/l);y--;)p=(b=d+l*y)*i-o,f.moveTo(0,p),f.lineTo(s,p),u[y]=[c(-b),p];if(f.closePath(),f.stroke(),y=h.length,this.labels){for(f.fillStyle=this.color.labelX,m=this.labelSize/2;y--;)b=h[y][0],f.fillText(b,h[y][1]-f.measureText(b).width/2,6+m);for(f.fillStyle=this.color.labelY,y=u.length;y--;)f.fillText(u[y][0]+"",4,u[y][1])}}},{key:"_drawFunction",value:function(e,t){if("function"==typeof e){t="object"===(void 0===t?"undefined":_typeof(t))?t:{};var i=this.canvas,n=this.offsetX,o=this.offsetY,s=this.scaleX,a=this.scaleY,r="number"==typeof t.width?t.width:i.width,l="number"==typeof t.min?t.min:n/s,f="number"==typeof t.max?t.max:(r+n)/s,c=l*s-n;if(!(c>r||l>=f)){var h=i.getContext("2d"),u=-e(l)*a-o,d=void 0;for(h.strokeStyle="string"==typeof t.color?t.color:"#000000",h.lineWidth=1,h.beginPath();c<r&&!((d=(c+n)/s)>f);)h.moveTo(c++,u),h.lineTo(c,u=-e(d)*a-o);h.closePath(),h.stroke()}}}},{key:"_resizeWindowEvent",value:function(e){var t=this;clearTimeout(window[t.resizeTimeoutID]),window[t.resizeTimeoutID]=setTimeout(function(){t.adjustSize().redraw()},t.redrawRate)}},{key:"_panStartEvent",value:function(e){this.panX=this.offsetX,this.panY=this.offsetY,this.canvas.parentNode.style.cursor="grabbing"}},{key:"_panMoveEvent",value:function(e){this.offsetX=this.panX-e.deltaX,this.offsetY=this.panY-e.deltaY,this.redraw(!0)}},{key:"_panEndEvent",value:function(e){this.panX=this.panY=0,this.canvas.parentNode.style.cursor=""}},{key:"drawFunctions",value:function(e){var t=this._isArray(e)&&e.length>0?e:this.functions;if(!this._isArray(t))return console.warning("invalid input object, skipping rendering phase"),this;for(var i=t.length,n=void 0,o=void 0;i--;)switch(n=t[i],o={width:this.canvas.width},void 0===n?"undefined":_typeof(n)){case"function":this._drawFunction(n,o);break;case"object":"function"==typeof n.fcn&&this._drawFunction(n.fcn,o)}return this}},{key:"setPosition",value:function(e,t){return this.offsetX="number"==typeof e?e:this.offsetX,this.offsetY="number"==typeof t?t:this.offsetY,this}},{key:"setPositionX",value:function(e){return this.offsetX="number"==typeof e?e:this.offsetX,this}},{key:"setPositionY",value:function(e){return this.offsetY="number"==typeof e?e:this.offsetY,this}},{key:"goToOrigin",value:function(){return this.offsetX=~~(-this.canvas.width/2),this.offsetY=~~(-this.canvas.height/2),this}},{key:"getScalePositionX",value:function(e){return-this.canvas.width/2+e*this.scaleX}},{key:"getScalePositionY",value:function(e){return-this.canvas.height/2+e*this.scaleY}},{key:"getCanvasX",value:function(e){return(e+this.canvas.width/2)/this.scaleX}},{key:"animate",value:function(e,t,i){(e="object"===(void 0===e?"undefined":_typeof(e))?e:{}).x="number"==typeof e.x?e.x:0,e.X="number"==typeof e.X?e.X:0,e.y="number"==typeof e.y?e.y:0,e.Y="number"==typeof e.Y?e.X:0,t="function"==typeof t?t:function(){};var n=this,o=n.offsetX,s=n.offsetY,a=o+(e.x||delta.X)*n.scaleX,r=s+(e.y||delta.Y)*n.scaleY,l=a-o,f=s-r;i="number"==typeof i?i:1750;var c=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t};console.log(o,a);var h=null,u=function(){};return e.x&&e.y?u=function(e){var a=e-(h=h||e);n.setPositionX(c(a,o,l,i)).setPositionY(c(a,s,f,i)).redraw(!0),a<i?requestAnimationFrame(u):t()}:e.x?u=function(e){var s=e-(h=h||e);n.setPositionX(c(s,o,l,i)).redraw(!0),s<i?requestAnimationFrame(u):t()}:e.y&&(u=function(e){var o=e-(h=h||e);n.setPositionY(c(o,s,f,i)).redraw(!0),o<i?requestAnimationFrame(u):t()}),requestAnimationFrame(u),this}},{key:"animateToCoordinate",value:function(e,t,i){var n=void 0,o=void 0,s=!1;if("number"==typeof(e="object"===(void 0===e?"undefined":_typeof(e))?e:{}).x){var a=(this.offsetX+this.canvas.width/2)*this.scaleX;n=e.x-a,s=!0}return"number"==typeof e.y&&(o=(this.offsetY+this.canvas.height/2)*this.scaleY+e.y,s=!0),s&&this.animate({x:n,y:o},t,duration),this}},{key:"animateToOrigin",value:function(){return this.animateToCoordinate({x:0,y:0}),this}},{key:"adjustSize",value:function(){var e=this.canvas.parentNode;return this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this}},{key:"hammerize",value:function(e){if("function"==typeof e){window.addEventListener("resize",this._resizeWindowEvent.bind(this));var t=new e(this.canvas);t.on("panstart",this._panStartEvent.bind(this)),t.on("panmove",this._panMoveEvent.bind(this)),t.on("panend",this._panEndEvent.bind(this))}else console.warn("invalid Hammer constructor passed as arg");return this}},{key:"redraw",value:function(e){return e&&this._clearCanvas(this.canvas),this.renderFunctions&&this.drawFunctions(),this._drawGrid(),this._drawIntercepts(),this}}]),e}();"undefined"!=typeof module&&(module.exports=plot);