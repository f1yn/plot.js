"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),plot=function(){function t(e,i){_classCallCheck(this,t);var n=document.createElement("canvas");i="object"===(void 0===i?"undefined":_typeof(i))?i:{},this.functions=[],this.color={grid:"string"==typeof i.gridColor?i.gridColor:"#ddd",axis:"string"==typeof i.axisColor?i.axisColor:"#888"},this.redrawRate="number"==typeof i.redrawRate?i.redrawRate:33,this.labels="boolean"!=typeof i.labels||i.labels,this.renderFunctions="boolean"!=typeof i.renderFunctions||i.renderFunctions,this.scaleX="number"==typeof i.scaleX?i.scaleX:1,this.scaleY="number"==typeof i.scaleY?i.scaleY:1,this.offsetX="number"==typeof i.offsetX?i.offsetX:0,this.offsetY="number"==typeof i.offsetY?i.offsetY:0,this.panX="number"==typeof i.panX?i.panX:0,this.panY="number"==typeof i.panY?i.panY:0,i.initRender="boolean"!=typeof i.initRender||i.initRender,i.hammerize="boolean"==typeof i.hammerize&&i.hammerize;var o=this._UID();this.resizeTimeoutID="_plot-resize-"+o,n.style.cursor="inherit",e.innerHTML="",e.style.overflow="hidden",e.appendChild(this.canvas=n),i.initRender&&(i.hammerize&&this.hammerize(),this.adjustSize().goToOrigin().redraw())}return _createClass(t,[{key:"_UID",value:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+t()+t()+t()}},{key:"_roundBaseX",value:function(t,e){return Math.pow(e,Math.floor(this._getBaseLog(e,t)))}},{key:"_getBaseLog",value:function(t,e){return Math.log(e)/Math.log(t)}},{key:"_strip",value:function(t){return parseFloat(t.toPrecision(4))}},{key:"_stripFixed",value:function(t){return parseFloat(t.toFixed(6))}},{key:"_isArray",value:function(t){return"object"===(void 0===t?"undefined":_typeof(t))&&"number"==typeof t.length}},{key:"_clearCanvas",value:function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)}},{key:"_drawIntercepts",value:function(){var t=this.canvas,e=t.width,i=t.height,n=-this.offsetX,o=-this.offsetY,s=t.getContext("2d");s.strokeStyle=this.color.axis,s.lineWidth=1,s.font="bold 18px Arial",n>=0&&n<=e&&(s.beginPath(),s.moveTo(n,0),s.lineTo(n,i),s.closePath(),o>10&&s.fillText("y",n+9,20),o<i&&s.fillText("-y",n+9,i-10),s.stroke()),o>=0&&o<=i&&(s.beginPath(),s.moveTo(0,o),s.lineTo(e,o),s.closePath(),n>10&&s.fillText("-x",10,o+16),n<e&&s.fillText("x",e-20,o+16),s.stroke())}},{key:"_drawGrid",value:function(){var t=this.canvas,e=this.scaleX,i=this.scaleY,n=this.offsetX,o=this.offsetY,s=t.width,r=t.height,a=(64/this._roundBaseX(e,2)).toPrecision(8),f=(64/this._roundBaseX(i,2)).toPrecision(8),h=t.getContext("2d"),l=this._stripFixed,u=[],c=[],d=0,p=void 0,v=void 0,y=void 0,m=void 0;for(h.strokeStyle=this.color.grid,h.lineWidth=1,h.font="bold 10px Arial",h.textBaseline="middle",h.fontcolor="#333",h.beginPath(),n>0?d=Math.ceil(n/e/a)*a:n<0&&(d=Math.floor(n/e/a)*a),p=2+~~(s/e/a);p--;)v=(m=d+a*p)*e-n,h.moveTo(v,0),h.lineTo(v,r),u[p]=[l(m),v];for(d=o<0?Math.floor(o/i/f)*f:o>0?Math.ceil(o/i/f)*f:0,p=2+~~(r/i/f);p--;)y=(m=d+f*p)*i-o,h.moveTo(0,y),h.lineTo(s,y),c[p]=[l(-m),y];if(h.closePath(),h.stroke(),h.fillStyle="#444",p=u.length,this.labels){for(;p--;)m=u[p][0],h.fillText(m,u[p][1]-h.measureText(m).width/2,10);for(p=c.length;p--;)h.fillText(c[p][0]+"",4,c[p][1])}}},{key:"_drawFunction",value:function(t,e){if("function"==typeof t){e="object"===(void 0===e?"undefined":_typeof(e))?e:{};var i=this.canvas,n=this.offsetX,o=this.offsetY,s=this.scaleX,r=this.scaleY,a="number"==typeof e.width?e.width:i.width,f="number"==typeof e.min?e.min:n/s,h="number"==typeof e.max?e.max:(a+n)/s,l=f*s-n;if(!(l>a||f>=h)){var u,c=i.getContext("2d"),d=-t(f)*r-o;for(c.strokeStyle="string"==typeof e.color?e.color:"#000000",c.lineWidth=1,c.beginPath();l<a&&!((u=(l+n)/s)>h);)c.moveTo(l++,d),c.lineTo(l,d=-t(u)*r-o);c.closePath(),c.stroke()}}}},{key:"_resizeWindowEvent",value:function(t){var e=this;clearTimeout(window[e.resizeTimeoutID]),window[e.resizeTimeoutID]=setTimeout(function(){e.adjustSize().redraw()},e.redrawRate)}},{key:"_panStartEvent",value:function(t){this.panX=this.offsetX,this.panY=this.offsetY,this.canvas.parentNode.style.cursor="grabbing"}},{key:"_panMoveEvent",value:function(t){this.offsetX=this.panX-t.deltaX,this.offsetY=this.panY-t.deltaY,this.redraw(!0)}},{key:"_panEndEvent",value:function(t){this.panX=this.panY=0,this.canvas.parentNode.style.cursor=""}},{key:"drawFunctions",value:function(t){var e=this._isArray(t)&&t.length>0?t:this.functions;if(!this._isArray(e))return console.warning("invalid input object, skipping rendering phase"),this;for(var i,n,o=e.length;o--;)switch(i=e[o],n={width:this.canvas.width},void 0===i?"undefined":_typeof(i)){case"function":this._drawFunction(i,n);break;case"object":"function"==typeof i.fcn&&this._drawFunction(i.fcn,n)}return this}},{key:"setPosition",value:function(t,e){return this.offsetX="number"==typeof t?t:this.offsetX,this.offsetY="number"==typeof e?e:this.offsetY,this}},{key:"setPositionX",value:function(t){return this.offsetX="number"==typeof t?t:this.offsetX,this}},{key:"setPositionY",value:function(t){return this.offsetY="number"==typeof t?t:this.offsetY,this}},{key:"goToOrigin",value:function(){return this.offsetX=~~(-this.canvas.width/2),this.offsetY=~~(-this.canvas.height/2),this}},{key:"adjustSize",value:function(){var t=this.canvas.parentNode;return this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,this}},{key:"hammerize",value:function(){window.addEventListener("resize",this._resizeWindowEvent.bind(this));var t=new Hammer(this.canvas);return t.on("panstart",this._panStartEvent.bind(this)),t.on("panmove",this._panMoveEvent.bind(this)),t.on("panend",this._panEndEvent.bind(this)),this}},{key:"redraw",value:function(t){return t&&this._clearCanvas(this.canvas),this.renderFunctions&&this.drawFunctions(),this._drawGrid(),this._drawIntercepts(),this}}]),t}();"undefined"!=typeof module&&(module.exports=plot);