"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),plot=function(){function e(t,i){_classCallCheck(this,e);var o=document.createElement("canvas");i="object"===(void 0===i?"undefined":_typeof(i))?i:{},this.functions=[],i.color="object"===_typeof(i.color)?i.color:{},this.color={grid:"string"==typeof i.color.grid?i.color.grid:"#ddd",axis:"string"==typeof i.color.axis?i.color.axis:"#888",axisLabel:"string"==typeof i.color.axisLabel?i.color.axisLabel:"#444",labelX:"string"==typeof i.color.labelX?i.color.labelX:"#444",labelY:"string"==typeof i.color.labelY?i.color.labelY:"#444"},this.redrawRate="number"==typeof i.redrawRate?i.redrawRate:33,this.labels="boolean"!=typeof i.labels||i.labels,this.renderFunctions="boolean"!=typeof i.renderFunctions||i.renderFunctions,this.scaleX="number"==typeof i.scaleX?i.scaleX:1,this.scaleY="number"==typeof i.scaleY?i.scaleY:1,this.offsetX="number"==typeof i.offsetX?i.offsetX:0,this.offsetY="number"==typeof i.offsetY?i.offsetY:0,this.panX="number"==typeof i.panX?i.panX:0,this.panY="number"==typeof i.panY?i.panY:0,i.initRender="boolean"!=typeof i.initRender||i.initRender;var n=this._UID();switch(this.resizeTimeoutID="_plot-resize-"+n,o.style.cursor="inherit",t.innerHTML="",t.style.overflow="hidden",t.appendChild(this.canvas=o),console.log(_typeof(i.hammerize),i.hammerize),_typeof(i.hammerize)){case"function":this.hammerize(i.hammerize);break;case"boolean":i.hammerize&&("function"==typeof window.Hammer?this.hammerize(window.Hammer):console.warn("no global Hammer constructor is preset, ignoring"));break;case"undefined":break;default:console.warn("unrecognized Hammer constructor is preset, ignoring")}i.initRender&&this.adjustSize().goToOrigin().redraw()}return _createClass(e,[{key:"_UID",value:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()}},{key:"_roundBaseX",value:function(e,t){return Math.pow(t,Math.floor(this._getBaseLog(t,e)))}},{key:"_getBaseLog",value:function(e,t){return Math.log(t)/Math.log(e)}},{key:"_strip",value:function(e){return parseFloat(e.toPrecision(4))}},{key:"_stripFixed",value:function(e){return parseFloat(e.toFixed(6))}},{key:"_isArray",value:function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"number"==typeof e.length}},{key:"_clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"_drawIntercepts",value:function(){var e=this.canvas,t=e.width,i=e.height,o=-this.offsetX,n=-this.offsetY,s=e.getContext("2d");s.strokeStyle=this.color.axis,s.lineWidth=1,s.font="bold 18px Arial",s.fillStyle=this.color.axisLabel,o>=0&&o<=t&&(s.beginPath(),s.moveTo(o,0),s.lineTo(o,i),s.closePath(),n>10&&s.fillText("y",o+9,20),n<i&&s.fillText("-y",o+9,i-10),s.stroke()),n>=0&&n<=i&&(s.beginPath(),s.moveTo(0,n),s.lineTo(t,n),s.closePath(),o>10&&s.fillText("-x",10,n+16),o<t&&s.fillText("x",t-20,n+16),s.stroke())}},{key:"_drawGrid",value:function(){var e=this.canvas,t=this.scaleX,i=this.scaleY,o=this.offsetX,n=this.offsetY,s=e.width,r=e.height,a=(64/this._roundBaseX(t,2)).toPrecision(8),l=(64/this._roundBaseX(i,2)).toPrecision(8),f=e.getContext("2d"),h=this._stripFixed,c=[],u=[],d=0,p=void 0,y=void 0,v=void 0,m=void 0;for(f.strokeStyle=this.color.grid,f.lineWidth=1,f.font="bold 10px Arial",f.textBaseline="middle",f.beginPath(),o>0?d=Math.ceil(o/t/a)*a:o<0&&(d=Math.floor(o/t/a)*a),p=2+~~(s/t/a);p--;)y=(m=d+a*p)*t-o,f.moveTo(y,0),f.lineTo(y,r),c[p]=[h(m),y];for(d=n<0?Math.floor(n/i/l)*l:n>0?Math.ceil(n/i/l)*l:0,p=2+~~(r/i/l);p--;)v=(m=d+l*p)*i-n,f.moveTo(0,v),f.lineTo(s,v),u[p]=[h(-m),v];if(f.closePath(),f.stroke(),p=c.length,this.labels){for(f.fillStyle=this.color.labelX;p--;)m=c[p][0],f.fillText(m,c[p][1]-f.measureText(m).width/2,10);for(f.fillStyle=this.color.labelY,p=u.length;p--;)f.fillText(u[p][0]+"",4,u[p][1])}}},{key:"_drawFunction",value:function(e,t){if("function"==typeof e){t="object"===(void 0===t?"undefined":_typeof(t))?t:{};var i=this.canvas,o=this.offsetX,n=this.offsetY,s=this.scaleX,r=this.scaleY,a="number"==typeof t.width?t.width:i.width,l="number"==typeof t.min?t.min:o/s,f="number"==typeof t.max?t.max:(a+o)/s,h=l*s-o;if(!(h>a||l>=f)){var c=i.getContext("2d"),u=-e(l)*r-n,d=void 0;for(c.strokeStyle="string"==typeof t.color?t.color:"#000000",c.lineWidth=1,c.beginPath();h<a&&!((d=(h+o)/s)>f);)c.moveTo(h++,u),c.lineTo(h,u=-e(d)*r-n);c.closePath(),c.stroke()}}}},{key:"_resizeWindowEvent",value:function(e){var t=this;clearTimeout(window[t.resizeTimeoutID]),window[t.resizeTimeoutID]=setTimeout(function(){t.adjustSize().redraw()},t.redrawRate)}},{key:"_panStartEvent",value:function(e){this.panX=this.offsetX,this.panY=this.offsetY,this.canvas.parentNode.style.cursor="grabbing"}},{key:"_panMoveEvent",value:function(e){this.offsetX=this.panX-e.deltaX,this.offsetY=this.panY-e.deltaY,this.redraw(!0)}},{key:"_panEndEvent",value:function(e){this.panX=this.panY=0,this.canvas.parentNode.style.cursor=""}},{key:"drawFunctions",value:function(e){var t=this._isArray(e)&&e.length>0?e:this.functions;if(!this._isArray(t))return console.warning("invalid input object, skipping rendering phase"),this;for(var i=t.length,o=void 0,n=void 0;i--;)switch(o=t[i],n={width:this.canvas.width},void 0===o?"undefined":_typeof(o)){case"function":this._drawFunction(o,n);break;case"object":"function"==typeof o.fcn&&this._drawFunction(o.fcn,n)}return this}},{key:"setPosition",value:function(e,t){return this.offsetX="number"==typeof e?e:this.offsetX,this.offsetY="number"==typeof t?t:this.offsetY,this}},{key:"setPositionX",value:function(e){return this.offsetX="number"==typeof e?e:this.offsetX,this}},{key:"setPositionY",value:function(e){return this.offsetY="number"==typeof e?e:this.offsetY,this}},{key:"goToOrigin",value:function(){return this.offsetX=~~(-this.canvas.width/2),this.offsetY=~~(-this.canvas.height/2),this}},{key:"adjustSize",value:function(){var e=this.canvas.parentNode;return this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this}},{key:"hammerize",value:function(e){if("function"==typeof e){window.addEventListener("resize",this._resizeWindowEvent.bind(this));var t=new e(this.canvas);t.on("panstart",this._panStartEvent.bind(this)),t.on("panmove",this._panMoveEvent.bind(this)),t.on("panend",this._panEndEvent.bind(this))}else console.warn("invalid Hammer constructor passed as arg");return this}},{key:"redraw",value:function(e){return e&&this._clearCanvas(this.canvas),this.renderFunctions&&this.drawFunctions(),this._drawGrid(),this._drawIntercepts(),this}}]),e}();"undefined"!=typeof module&&(module.exports=plot);